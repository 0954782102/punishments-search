<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>–ü–æ—à—É–∫ –ø–æ–∫–∞—Ä–∞–Ω—å —ñ —á–∞—Ç Furry</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMLWEX4GXT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TMLWEX4GXT');
</script>
<!-- End Google Analytics -->

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>

  :root{--blue:#1a73e8;--bg:#e8f0fe;--card:#ffffff;--muted:#6b778c;--accent:#0b59d6;}
  html,body{height:100%;margin:0;}
  body { font-family: 'Roboto', sans-serif; background: var(--bg); display:flex; flex-direction:column; align-items:center; padding:30px 10px; box-sizing:border-box; }
  h1 { color: var(--blue); margin:8px 0 12px; text-align:center; }
  .logo { margin-bottom:14px; }
  .logo img { width:120px; height:auto; border-radius:12px; cursor:pointer; }

  input.search { padding:14px; width:600px; border:2px solid var(--blue); border-radius:12px; margin-bottom:18px; font-size:16px; outline:none; transition:.18s; }
  input.search:focus{ box-shadow:0 8px 20px rgba(26,115,232,.12); transform:translateY(-1px); }
  .result { background:var(--card); padding:22px; border-radius:14px; box-shadow:0 6px 18px rgba(10,30,80,0.06); width:700px; max-width:96%; white-space:pre-wrap; line-height:1.6; font-size:15px; color:#202124; margin-bottom:20px; }

  .chat-container { width:700px; max-width:96%; background:var(--card); border-radius:14px; box-shadow:0 6px 18px rgba(10,30,80,0.06); padding:14px; display:flex; flex-direction:column; max-height:520px; overflow:hidden; }
  .chat-messages { flex:1; overflow-y:auto; padding:6px; }
  .message { margin-bottom:8px; padding:8px 12px; border-radius:12px; max-width:80%; line-height:1.4; word-break:break-word; }
  .user-msg { background:var(--accent); color:#fff; align-self:flex-end; }
  .furry-msg { background:#f1f8ff; color:#0b2b5a; align-self:flex-start; }
  .typing { font-style:italic; font-size:13px; color:var(--muted); margin-bottom:6px; }
  .chat-input { display:flex; gap:8px; margin-top:8px; }
  .chat-input input { flex:1; padding:10px; font-size:14px; border:2px solid var(--blue); border-radius:8px; }
  .chat-input button { padding:10px 16px; font-weight:700; border-radius:8px; background:var(--blue); color:#fff; border:none; cursor:pointer; }

  /* modal / audio UI */
  .modal-backdrop { position:fixed; inset:0; background:linear-gradient(rgba(7,19,43,.45), rgba(7,19,43,.45)); display:flex; align-items:center; justify-content:center; z-index:9999; }
  .modal-audio { width:min(760px,94%); background:linear-gradient(180deg,#ffffff,#f7fbff); border-radius:14px; padding:18px; box-shadow:0 18px 50px rgba(5,30,80,.35); border:1px solid rgba(26,115,232,.08); display:flex; flex-direction:column; gap:12px; }
  .modal-head { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .modal-title { font-weight:700; color:var(--blue); font-size:18px; }
  .modal-close { background:transparent; border:none; font-size:18px; cursor:pointer; color:var(--muted); }

  .audio-card { display:flex; gap:14px; align-items:center; }
  .audio-icon { width:86px; height:86px; border-radius:12px; background:linear-gradient(180deg,var(--blue),#0958c2); display:flex; align-items:center; justify-content:center; color:#fff; font-size:34px; box-shadow:0 10px 24px rgba(10,30,80,0.12); }
  .audio-meta { flex:1; display:flex; flex-direction:column; gap:8px; }
  .audio-controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .big-btn { width:56px; height:56px; border-radius:12px; border:none; background:var(--accent); color:#fff; font-size:20px; cursor:pointer; box-shadow:0 8px 18px rgba(11,89,214,0.18); }
  .secondary-btn { padding:10px 12px; border-radius:10px; border:1px solid rgba(11,89,214,0.12); background:#fff; cursor:pointer; color:var(--blue); font-weight:700; }

  .progress-wrap { display:flex; gap:12px; align-items:center; }
  .time { font-size:13px; color:var(--muted); min-width:56px; text-align:center; }
  .progress { -webkit-appearance:none; appearance:none; width:100%; height:10px; border-radius:8px; background:linear-gradient(90deg,#dfeeff,#eef6ff); position:relative; overflow:hidden; }
  .progress::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:var(--blue); box-shadow:0 2px 8px rgba(26,115,232,.3); cursor:pointer; margin-top:-3px; border:3px solid #fff; }

  .modal-actions { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .small-muted { font-size:13px; color:var(--muted); }

  .file-row{ display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
  .file-row input[type="file"]{ padding:6px; }

  .url-input { display:flex; gap:8px; align-items:center; width:100%; }
  .url-input input { flex:1; padding:8px; border-radius:8px; border:1px solid #cfdffb; }

  @media(max-width:768px){
    input.search { width:100%; }
    .audio-icon{ width:68px; height:68px; font-size:28px;}
    .big-btn{ width:48px; height:48px; }
    .result, .chat-container{ width:100%; }
  }
</style>
</head>
<body>

  <div class="logo">
    <a href="https://ibb.co/5bsnjyM" target="_blank" rel="noreferrer">
      <img src="https://i.ibb.co/5bsnjyM/logo.png" alt="Furry Logo">
    </a>
  </div>

  <h1>–ü–æ—à—É–∫ –ø–æ–∫–∞—Ä–∞–Ω—å</h1>
  <input class="search" type="text" id="search" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ DM, DB, TK, SK, PG, –ù—ñ–∫–Ω–µ–π–º)...">
  <div class="result" id="result">–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –ø–æ–∫–∞—Ä–∞–Ω–Ω—è</div>

  <div class="chat-container">
    <div class="chat-messages" id="chat-messages">
      <div class="furry-msg">–ü—Ä–∏–≤—ñ—Ç, —è Furry üòé. –Ø –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑–Ω–∞–π—Ç–∏ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è –∞–±–æ –¥–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –ø–æ —Å–∞–π—Ç—É. –ù–µ –∑–∞–±—É–≤–∞–π—Ç–µ –ø—Ä–æ –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π Discord —Ç–∞ –ø—Ä–∞–≤–∏–ª–∞!</div>
    </div>
    <div class="chat-input">
      <input type="text" id="chat-input" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...">
      <button id="chat-send">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
    </div>
  </div>

  <!-- AUDIO MODAL WITH FILE INPUT & URL (prefilled with your Dropbox dl=1) -->
  <div id="introModal" class="modal-backdrop" style="display:none;">
    <div class="modal-audio" role="dialog" aria-modal="true">
      <div class="modal-head">
        <div class="modal-title">–í—ñ–¥–∫—Ä–∏—Ç—Ç—è —Å–∞–π—Ç—É ‚Ä¢ –í–µ—Ä—Å—ñ—è 0.1</div>
        <button id="modalClose" class="modal-close" title="–ó–∞–∫—Ä–∏—Ç–∏">‚úï</button>
      </div>

      <div class="audio-card">
        <div class="audio-icon">üéô</div>
        <div class="audio-meta">

          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div style="font-weight:700;color:#0b2b5a;">–ü—Ä–æ—Å–ª—É—Ö–∞–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –≤—ñ–¥ Furry</div>
            <div class="small-muted">–í–µ—Ä—Å—ñ—è 0.1</div>
          </div>

          <div class="audio-controls">
            <button id="playBtn" class="big-btn" title="Play">‚ñ∂</button>
            <button id="pauseBtn" class="secondary-btn" title="Pause">‚è∏</button>
            <button id="stopBtn" class="secondary-btn" title="Stop">‚èπ</button>
            <div style="flex:1"></div>
            <div class="small-muted" id="audioSourceLabel">–î–∂–µ—Ä–µ–ª–æ: –Ω–µ –≤–∏–±—Ä–∞–Ω–æ</div>
          </div>

          <div class="progress-wrap">
            <div class="time" id="curTime">0:00</div>
            <input id="seek" class="progress" type="range" min="0" max="100" value="0">
            <div class="time" id="durTime">0:00</div>
          </div>

          <div class="file-row">
            <label style="font-weight:600;">–û–±–µ—Ä—ñ—Ç—å –ª–æ–∫–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª (MP3):</label>
            <input id="fileInput" type="file" accept="audio/*">
            <button id="useFileBtn" class="secondary-btn">–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ñ–∞–π–ª</button>
          </div>

          <div class="url-input">
            <input id="urlInput" type="text" placeholder="–ê–±–æ –≤—Å—Ç–∞–≤—Ç–µ –ø—Ä—è–º–∏–π URL –Ω–∞ –∞—É–¥—ñ–æ (https://.../file.mp3)">
            <button id="useUrlBtn" class="secondary-btn">–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ URL</button>
          </div>

        </div>
      </div>

      <div class="modal-actions">
        <div class="small-muted">–ü–æ—Ä–∞–¥–∞: –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ–≥–æ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—Ä–∞—â–µ –º–∞—Ç–∏ –ø—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ `.mp3` –∞–±–æ –≤–∏–±—Ä–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª.</div>
        <div>
          <button id="neverShow" class="btn">–ù–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* =======================
   –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –ø–æ—à—É–∫—É / —á–∞—Ç (–Ω–µ –∑–º—ñ–Ω–µ–Ω–∞ –ø–æ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É)
   ======================= */

const punishments = {
  "dm": { rule: "4.1", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "mass dm": { rule: "4.1.1", punishment: "Jail 120 —Ö–≤–∏–ª–∏–Ω" },
  "dm –≤ gz": { rule: "4.1.2", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "mass dm –≤ gz": { rule: "4.1.3", punishment: "Warn" },
  "db": { rule: "4.2", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "mass db": { rule: "4.2.1", punishment: "Jail 60 —Ö–≤–∏–ª–∏–Ω" },
  "db –≤ gz": { rule: "4.2.2", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "mass db –≤ gz": { rule: "4.2.3", punishment: "Warn" },
  "—Ä–∫": { rule: "4.3", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "rpk": { rule: "4.3.1", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "sk": { rule: "4.4", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "mass sk": { rule: "4.4.1", punishment: "Jail 120 —Ö–≤–∏–ª–∏–Ω" },
  "tk": { rule: "4.5", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "mass tk": { rule: "4.5.1", punishment: "Jail 60 —Ö–≤–∏–ª–∏–Ω" },
  "pg": { rule: "4.6", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "nonrp": { rule: "4.7", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "nonrp cop": { rule: "4.7.1", punishment: "Jail 60 —Ö–≤ / Warn" },
  "–≤–∏—Ö—ñ–¥ –ø—ñ–¥ —á–∞—Å —Ä–ø": { rule: "4.8", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "—É–Ω–∏–∫–∞–Ω–Ω—è –ø–æ–≥–æ–Ω–∏ —ñ–Ω—Ç–µ—Ä'—î—Ä–∏": { rule: "4.9", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "—É–Ω–∏–∫–∞–Ω–Ω—è –ø–æ–≥–æ–Ω–∏ –≤–æ–¥–∞": { rule: "4.10", punishment: "Jail 20 —Ö–≤–∏–ª–∏–Ω" },
  "–≤—Ç—Ä—É—á–∞–Ω–Ω—è –≤ —Ä–ø": { rule: "4.11", punishment: "Jail 10 —Ö–≤–∏–ª–∏–Ω" },
  "–ø–µ—Ä–µ—à–∫–æ–¥–∏ —Ä–ø": { rule: "4.12", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "—É–Ω–∏–∫–∞–Ω–Ω—è —Ä–ø": { rule: "4.13", punishment: "Jail 30 —Ö–≤–∏–ª–∏–Ω" },
  "–∞—Ñ–∫ —Ñ—Ä–∞–∫—Ü—ñ—è": { rule: "4.15", punishment: "Kick" },
  "—Å–∫—ñ–Ω –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ—ó —Å—Ç–∞—Ç—ñ": { rule: "4.16", punishment: "–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è / –ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è" },
  "–≥—Ä–æ—à–æ–≤—ñ –º–∞—Ö—ñ–Ω–∞—Ü—ñ—ó –º–∞–ª—ñ": { rule: "4.17", punishment: "–ë–∞–Ω –¥–æ 60 –¥–Ω—ñ–≤" },
  "–≥—Ä–æ—à–æ–≤—ñ –º–∞—Ö—ñ–Ω–∞—Ü—ñ—ó –≤–µ–ª–∏–∫—ñ": { rule: "4.18", punishment: "–ü–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –±–∞–Ω" },
  "–æ–±–º–∞–Ω –º–∞–π–Ω–æ": { rule: "4.19", punishment: "–ü–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –±–∞–Ω" },
  "—Å–ø–∞–º –º–∞–π–Ω–æ": { rule: "4.20", punishment: "–ü–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –±–∞–Ω" },
  "–±–∞–Ω–∫—ñ–≤—Å—å–∫—ñ –ø–æ—Å–ª—É–≥–∏": { rule: "4.21", punishment: "–ü–µ—Ä–º–∞–Ω–µ–Ω—Ç–Ω–∏–π –±–∞–Ω" },
  "–∑–º–µ–Ω—à–µ–Ω–µ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è –∑–∞ –æ–±–º–∞–Ω": { rule: "4.22", punishment: "–ë–∞–Ω 3-15 –¥–Ω—ñ–≤" },
  "–ø–æ–≥—Ä–æ–∑–∏": { rule: "4.23", punishment: "Jail / Mute 30 —Ö–≤–∏–ª–∏–Ω" },
  "mg": { rule: "5.1", punishment: "–ú—É—Ç 20 —Ö–≤ / Warn" },
  "tl": { rule: "5.2", punishment: "–ú—É—Ç 5 —Ö–≤–∏–ª–∏–Ω" },
  "–¥—É–∂–∫–∏ ic": { rule: "5.3", punishment: "–ú—É—Ç 5 —Ö–≤–∏–ª–∏–Ω" },
  "flood": { rule: "5.4", punishment: "–ú—É—Ç 10 —Ö–≤–∏–ª–∏–Ω" },
  "–º—É–∑–∏–∫–∞/–∑–º—ñ–Ω–∞ –≥–æ–ª–æ—Å—É": { rule: "5.5", punishment: "–ú—É—Ç 15 —Ö–≤–∏–ª–∏–Ω" },
  "caps": { rule: "5.6", punishment: "–ú—É—Ç 5 —Ö–≤–∏–ª–∏–Ω" },
  "–Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞ –ª–µ–∫—Å–∏–∫–∞": { rule: "5.7", punishment: "–ú—É—Ç 20-60 —Ö–≤" }
};

document.getElementById("search").addEventListener("input", function(){
  const query = this.value.trim().toLowerCase();
  const resultBox = document.getElementById("result");
  if(!query){ resultBox.textContent = "–¢—É—Ç –∑'—è–≤–∏—Ç—å—Å—è –ø–æ–∫–∞—Ä–∞–Ω–Ω—è"; return; }
  let results=[];
  for(let key in punishments){
    if(key.includes(query) || punishments[key].punishment.toLowerCase().includes(query)){
      results.push(`${punishments[key].rule}: ${key.toUpperCase()}: ${punishments[key].punishment}`);
    }
  }
  resultBox.textContent = results.length>0 ? results.join('\n') : "–ü–æ–∫–∞—Ä–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
});

/* ===== Chat ===== */
const chatInput = document.getElementById('chat-input');
const chatSend = document.getElementById('chat-send');
const chatMessages = document.getElementById('chat-messages');

function appendMessage(text, className){
  const div = document.createElement('div');
  div.className = `message ${className}`;
  div.textContent = text;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function searchPunishment(query){
  query = query.toLowerCase();
  let results = [];
  for(let key in punishments){
    if(key.includes(query) || punishments[key].punishment.toLowerCase().includes(query)){
      results.push(`${punishments[key].rule}: ${key.toUpperCase()}: ${punishments[key].punishment}`);
    }
  }
  return results.length>0 ? results.join('\n') : null;
}

function getResponse(msg){
  const m = msg.toLowerCase();
  if(/–ø—Ä–∏–≤—ñ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|hi/.test(m)) return "–ü—Ä–∏–≤—ñ—Ç! –Ø Furry üòé. –ú–æ–∂—É –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è –∞–±–æ –¥–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó.";
  const punishment = searchPunishment(m);
  if(punishment) return punishment;
  if(/—è–∫|—â–æ —Ä–æ–±–∏—Ç–∏|–¥–∞–ª—ñ|—è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—å|—â–æ —Ç—É—Ç/.test(m)) return "–í–≤–µ–¥–∏ –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è –∞–±–æ –Ω—ñ–∫ —ñ —è –ø–æ–∫–∞–∂—É –ø–æ–∫–∞—Ä–∞–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: DM, DB, TK, SK, PG.";
  if(/—Ö—Ç–æ —Å—Ç–≤–æ—Ä–∏–≤|—Ç–≤—ñ–π —Ç–≤–æ—Ä–µ—Ü—å|who created/i.test(m)) return "–ú–µ–Ω–µ —Å—Ç–≤–æ—Ä–∏–≤ –ê—Ä—Ç–µ–º –ü—Ä–æ—Ü–∫–æ, –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–æ–≤–∏ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è Python —Ç–∞ —Å–∫—Ä–∏–ø—Ç—É Jarvis. –Ø –¥–æ–ø–æ–º–∞–≥–∞—é –∞–¥–º—ñ–Ω—É –Æ–ê –æ–Ω–ª–∞–π–Ω. –í–µ—Ä—Å—ñ—è 0.1, –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∞–≤—Ç–æ—Ä Artem_Furrry. –ú–∞—é —Å–≤—ñ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —á—ñ—Ç–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π.";
  if(/—ñ–Ω—Å—Ç—Ä—É–∫—Ü|—è–∫ –∑–Ω–∞–π—Ç–∏|–ø–æ—à—É–∫/i.test(m)) return "–©–æ–± –∑–Ω–∞–π—Ç–∏ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è, –≤–≤–µ–¥–∏ –∫–ª—é—á–æ–≤–µ —Å–ª–æ–≤–æ (DM, DB, TK, SK, PG, –ù—ñ–∫–Ω–µ–π–º) —É –ø–æ–ª–µ –ø–æ—à—É–∫—É –∞–±–æ –∑–∞–ø–∏—Ç–∞–π –º–µ–Ω–µ –≤ —á–∞—Ç—ñ.";
  return "–Ø –º–æ–∂—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑–Ω–∞–π—Ç–∏ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è –∞–±–æ –¥–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é –ø–æ —Å–∞–π—Ç—É. –°–ø—Ä–æ–±—É–π –Ω–∞–ø–∏—Å–∞—Ç–∏ DM, DB, TK —Ç–æ—â–æ.";
}

function furryReply(userMsg){
  const typing = document.createElement('div');
  typing.className='typing';
  typing.textContent='Furry –¥—Ä—É–∫—É—î...';
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;
  setTimeout(()=>{
    chatMessages.removeChild(typing);
    appendMessage(getResponse(userMsg),'furry-msg');
  }, 700 + Math.random()*500);
}

chatSend.addEventListener('click', ()=>{
  const text = chatInput.value.trim();
  if(!text) return;
  appendMessage(text,'user-msg');
  chatInput.value='';
  furryReply(text);
});
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter') chatSend.click(); });

/* ===== Audio modal logic: support direct Dropbox URL and local file ===== */
(function(){
  const modal = document.getElementById('introModal');
  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stopBtn = document.getElementById('stopBtn');
  const closeBtn = document.getElementById('modalClose');
  const neverBtn = document.getElementById('neverShow');
  const fileInput = document.getElementById('fileInput');
  const useFileBtn = document.getElementById('useFileBtn');
  const urlInput = document.getElementById('urlInput');
  const useUrlBtn = document.getElementById('useUrlBtn');
  const seek = document.getElementById('seek');
  const curTime = document.getElementById('curTime');
  const durTime = document.getElementById('durTime');
  const audioSourceLabel = document.getElementById('audioSourceLabel');

  // Pre-fill with —Ç–≤–æ—é –ø—Ä—è–º—É Dropbox-—Å—Å–∏–ª–∫—É (dl=1)
  const PREFILL_DIRECT = "https://www.dropbox.com/scl/fi/0e3gjm85cs1x9xdz1qono/ElevenLabs_2025-09-05T12_53_24_Dmytro-UA_pvc_sp100_s50_sb70_se15_b_m2.mp3?rlkey=kn5uv7i9c04p19g2h7lgji7vd&st=jmw1axgx&dl=1";
  urlInput.value = PREFILL_DIRECT;

  let audio = new Audio();
  audio.preload = 'auto';
  let objectUrl = null;

  function shouldShow() { return localStorage.getItem('furry_modal_shown') !== 'true'; }
  function markSeen(){ localStorage.setItem('furry_modal_shown','true'); }

  function fmt(t){
    if(isNaN(t) || !isFinite(t)) return '0:00';
    const mins = Math.floor(t/60);
    const secs = Math.floor(t%60).toString().padStart(2,'0');
    return `${mins}:${secs}`;
  }

  function updateTime(){
    curTime.textContent = fmt(audio.currentTime);
    durTime.textContent = fmt(audio.duration);
    if(audio.duration && !isNaN(audio.duration)) {
      seek.value = Math.floor((audio.currentTime / audio.duration) * 100);
    } else {
      seek.value = 0;
    }
  }

  audio.addEventListener('timeupdate', updateTime);
  audio.addEventListener('loadedmetadata', ()=>{ durTime.textContent = fmt(audio.duration); });
  audio.addEventListener('ended', ()=>{ playBtn.textContent = '‚ñ∂'; seek.value = 100; });

  audio.addEventListener('error', (e)=> {
    console.warn('Audio error', e);
    // –ø–æ–∫–∞–∑—É—î–º–æ –∞–ª–µ—Ä—Ç –ª–∏—à–µ —è–∫—â–æ —î –¥–∂–µ—Ä–µ–ª–æ, —â–æ–± –Ω–µ —Å–ø–∞–º–∏—Ç–∏
    if(audio.src) alert('–ù–µ –≤–¥–∞–ª–æ—Å—å –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∞—É–¥—ñ–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL –∞–±–æ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É.');
    audioSourceLabel.textContent = '–î–∂–µ—Ä–µ–ª–æ: –ø–æ–º–∏–ª–∫–∞';
  });

  // Play
  playBtn.addEventListener('click', ()=>{
    if(!audio.src){
      alert('–°–ø–æ—á–∞—Ç–∫—É –≤–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ URL".');
      return;
    }
    audio.play().then(()=>{ playBtn.textContent='‚è∏'; }).catch(err=>{
      console.warn('Play failed', err);
      alert('–ù–µ –≤–¥–∞–ª–æ—Å—å –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –∞—É–¥—ñ–æ: –º–æ–∂–ª–∏–≤–æ –±—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫—É—î –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–±–æ URL –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.');
    });
  });

  // Pause
  pauseBtn.addEventListener('click', ()=>{
    if(!audio.src) return;
    if(!audio.paused){ audio.pause(); playBtn.textContent='‚ñ∂'; } else { audio.play().then(()=>playBtn.textContent='‚è∏').catch(()=>{}); }
  });

  // Stop
  stopBtn.addEventListener('click', ()=>{
    if(!audio.src) return;
    audio.pause();
    audio.currentTime = 0;
    playBtn.textContent = '‚ñ∂';
    seek.value = 0;
  });

  // Seek
  seek.addEventListener('input', ()=>{
    if(audio.duration && !isNaN(audio.duration)) {
      const pct = parseFloat(seek.value)/100;
      audio.currentTime = pct * audio.duration;
    }
  });

  // Use URL
  function useUrl(url){
    try {
      // cleanup objectUrl if existed
      if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = null; }
      audio.pause();
      audio.src = url;
      audio.load();
      audioSourceLabel.textContent = '–î–∂–µ—Ä–µ–ª–æ: URL';
      // Reset UI
      playBtn.textContent = '‚ñ∂';
      seek.value = 0;
      curTime.textContent = '0:00';
      durTime.textContent = '0:00';
    } catch(e){
      console.error('useUrl error', e);
      alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ URL.');
    }
  }

  useUrlBtn.addEventListener('click', ()=>{
    const u = urlInput.value.trim();
    if(!u){ alert('–í—Å—Ç–∞–≤—Ç–µ URL —É –ø–æ–ª–µ.'); return; }
    useUrl(u);
  });

  // Use local file
  useFileBtn.addEventListener('click', ()=>{
    const f = fileInput.files && fileInput.files[0];
    if(!f){ alert('–§–∞–π–ª –Ω–µ –≤–∏–±—Ä–∞–Ω–æ.'); return; }
    if(!f.type.startsWith('audio')){ alert('–û–±–µ—Ä—ñ—Ç—å –∞—É–¥—ñ–æ—Ñ–∞–π–ª (mp3/ogg/m4a).'); return; }
    if(objectUrl){ URL.revokeObjectURL(objectUrl); objectUrl = null; }
    objectUrl = URL.createObjectURL(f);
    audio.pause();
    audio.src = objectUrl;
    audio.load();
    audioSourceLabel.textContent = `–î–∂–µ—Ä–µ–ª–æ: –ª–æ–∫–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª (${f.name})`;
    playBtn.textContent = '‚ñ∂';
    seek.value = 0;
    curTime.textContent = '0:00';
    durTime.textContent = '0:00';
  });

  // Close / never show
  closeBtn.addEventListener('click', ()=>{
    modal.style.display = 'none';
    markSeen();
    try { audio.pause(); audio.currentTime = 0; } catch(e){}
  });
  neverBtn.addEventListener('click', ()=>{
    localStorage.setItem('furry_modal_shown','true');
    modal.style.display = 'none';
    try { audio.pause(); audio.currentTime = 0; } catch(e){}
  });

  // Show modal on first load and auto-fill URL (but NOT autoplay)
  document.addEventListener('DOMContentLoaded', ()=>{
    if(shouldShow()){
      modal.style.display = 'flex';
      // prefill URL already set; auto-call useUrl to prepare source (no autoplay)
      useUrl(PREFILL_DIRECT);
    }
  });

  // cleanup on unload
  window.addEventListener('beforeunload', ()=>{
    try { if(objectUrl) URL.revokeObjectURL(objectUrl); } catch(e){}
  });

})();
</script>

</body>
</html>
